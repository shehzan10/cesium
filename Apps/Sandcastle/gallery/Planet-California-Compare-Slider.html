<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Use Viewer to start building new applications or easily embed Cesium into existing applications.">
    <meta name="cesium-sandcastle-labels" content="Beginner, Showcases">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="text/javascript" src="../../../ThirdParty/requirejs-2.1.20/require.js"></script>
    <script type="text/javascript">
    require.config({
        baseUrl : '../../../Source',
        waitSeconds : 60
    });
    </script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<style>
    @import url(../templates/bucket.css);
    #slider {
        position: absolute;
        left: 50%;
        top: 0px;
        background-color: #D3D3D3;
        width: 2px;
        height: 100%;
        z-index: 9999;
    }

    #slider:hover {
        cursor: ew-resize;
    }

    #toolbar {
        background: rgba(42, 42, 42, 0.8);
        padding: 4px;
        border-radius: 4px;
    }
    #toolbar input {
        vertical-align: middle;
        padding-top: 2px;
        padding-bottom: 2px;
    }
    #toolbar table tr {
        transform: translateY(0);
        transition: transform 0.4s ease-out;
    }
</style>
<div id="cesiumContainer" class="fullSize">
    <div id="slider"></div>
</div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar">
    <table>
        <tbody>
        <tr><td><strong style="font-size: 14px;">Compare California 2014 Winter to 2015 Summer
        <tr><td><strong style="font-size: 14px;">(With Landsat tileset as globe)</strong></td>
        <tr><td><strong style="font-size: 14px;">Image Layer Adjustments</strong></td>
        </tr><tr>
            <td>Brightness</td>
            <td>
                <input type="range" min="0" max="3" step="0.02" data-bind="value: brightness, valueUpdate: 'input'">
                <input type="text" size="5" data-bind="value: brightness">
            </td>
        </tr>
        <tr>
            <td>Contrast</td>
            <td>
                <input type="range" min="0" max="3" step="0.02" data-bind="value: contrast, valueUpdate: 'input'">
                <input type="text" size="5" data-bind="value: contrast">
            </td>
        </tr>
        <tr>
            <td>Hue</td>
            <td>
                <input type="range" min="0" max="3" step="0.02" data-bind="value: hue, valueUpdate: 'input'">
                <input type="text" size="5" data-bind="value: hue">
            </td>
        </tr>
        <tr>
            <td>Saturation</td>
            <td>
                <input type="range" min="0" max="3" step="0.02" data-bind="value: saturation, valueUpdate: 'input'">
                <input type="text" size="5" data-bind="value: saturation">
            </td>
        </tr>
        <tr>
            <td>Gamma</td>
            <td>
                <input type="range" min="0" max="3" step="0.02" data-bind="value: gamma, valueUpdate: 'input'">
                <input type="text" size="5" data-bind="value: gamma">
            </td>
        </tr>
        </tbody>
    </table>
</div>
<script id="cesium_sandcastle_script">
function startup(Cesium) {
    'use strict';
//Sandcastle_Begin
var viewer = new Cesium.Viewer('cesiumContainer', {
    imageryProvider : undefined,
    baseLayerPicker : false,
    shadows : true,
    terrainShadows : Cesium.ShadowMode.ENABLED
});

var imageryLayers = viewer.imageryLayers;

////////////////////////////////////////////////
// Start off looking at California.
viewer.camera.setView({
    destination: Cesium.Rectangle.fromDegrees(-125, 32, -115, 43)
});
////////////////////////////////////////////////

////////////////////////////////////////////////
// Base Layers
// Clear all default layers
imageryLayers.removeAll(false);
var planet_api_key = '?api_key=dfa8215647244cec9ba8855978089349';
var planetMapsLayer = imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({
    url : 'https://tiles.planet.com/v0/mosaics/landsat8_toa_rgb_mosaic/{z}/{x}/{y}.png' + planet_api_key
}));
////////////////////////////////////////////////

////////////////////////////////////////////////
// California Seasonal
var californiaSeasons = [
    'california_re_20141201_20150228',
    'california_re_20150601_20150831'
];
var californiaLayers = [];

for(var i = 0; i < californiaSeasons.length; ++i) {
    californiaLayers.push(imageryLayers.addImageryProvider(
        new Cesium.UrlTemplateImageryProvider({
            url : 'https://tiles.planet.com/v0/mosaics/open_' + californiaSeasons[i] + '/{z}/{x}/{y}.png' + planet_api_key
        })
    ));
}
////////////////////////////////////////////////

////////////////////////////////////////////////
// Terrain
var cesiumTerrainProviderMeshes = new Cesium.CesiumTerrainProvider({
    url : 'https://assets.agi.com/stk-terrain/world',
    requestWaterMask : false,
    requestVertexNormals : true
});
viewer.terrainProvider = cesiumTerrainProviderMeshes;
////////////////////////////////////////////////

////////////////////////////////////////////////
// 3D Tiles
var tileset = new Cesium.Cesium3DTileset({
    url: "https://beta.cesiumcontent.com/api/assets/486?access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwZDlkODZhMy1lNWUxLTQ1ZDAtOWJiYS1kZTRlOTE5YzJjZDEiLCJpZCI6OCwiaWF0IjoxNDczNDQyNDIxfQ.iIrl-RnpbKV_XBDUpdqpc-vRpMf2y-tEF0aDCtRYSJg"
});
viewer.scene.primitives.add(tileset);
////////////////////////////////////////////////

////////////////////////////////////////////////
// GUI
Sandcastle.addToggleButton('Lightning', viewer.scene.globe.enableLighting, function(checked) {
    viewer.scene.globe.enableLighting = checked;
});

Sandcastle.addToggleButton('Shadows', viewer.shadows, function(checked) {
    viewer.shadows = checked;
    viewer.terrainShadows = checked ? Cesium.ShadowMode.ENABLED : Cesium.ShadowMode.DISABLED;
});

// The viewModel tracks the state of our mini application.
var viewModel = {
    brightness: 0,
    contrast: 0,
    hue: 0,
    saturation: 0,
    gamma: 0
};
// Convert the viewModel members into knockout observables.
Cesium.knockout.track(viewModel);

// Bind the viewModel to the DOM elements of the UI that call for it.
var toolbar = document.getElementById('toolbar');
Cesium.knockout.applyBindings(viewModel, toolbar);

function subscribeLayerParameter(name) {
    Cesium.knockout.getObservable(viewModel, name).subscribe(
        function(newValue) {
            for(var i = 0; i < imageryLayers.length; ++i) {
                var layer = imageryLayers.get(i);
                layer[name] = newValue;
            }
        }
    );
}
subscribeLayerParameter('brightness');
subscribeLayerParameter('contrast');
subscribeLayerParameter('hue');
subscribeLayerParameter('saturation');
subscribeLayerParameter('gamma');

// Set defaults
viewModel.brightness = imageryLayers.get(0).brightness;
viewModel.contrast = imageryLayers.get(0).contrast;
viewModel.hue = imageryLayers.get(0).hue;
viewModel.saturation = imageryLayers.get(0).saturation;
viewModel.gamma = imageryLayers.get(0).gamma;
////////////////////////////////////////////////

////////////////////////////////////////////////
// Camera Prebaked
function setCameraTargetOffset(target, offset) {
    viewer.camera.lookAt(target, offset);
    viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
}
var target;
var offset;

var cameraTargets = [{
    text : 'California',
    onselect : function() {
        viewer.camera.setView({
            destination: Cesium.Rectangle.fromDegrees(-125, 32, -115, 43)
        });
    }
}, {
    text : 'San Francisco',
    onselect : function() {
        target = Cesium.Cartesian3.fromDegrees(-122.4194, 37.7749, 0.0);
        offset = new Cesium.Cartesian3(0, -1500.0, 1500.0);
        setCameraTargetOffset(target, offset);
    }
}, {
    text : 'Mount Whitney',
    onselect : function() {
        target = Cesium.Cartesian3.fromDegrees(-118.2923, 36.5785, 0.0);
        offset = new Cesium.Cartesian3(5000, -5000.0, 5000.0);
        setCameraTargetOffset(target, offset);
    }
}, {
    text : 'Sandstone Peak',
    onselect : function() {
        target = Cesium.Cartesian3.fromDegrees(-118.9320, 34.1204, 0.0);
        offset = new Cesium.Cartesian3(5000, -5000.0, 5000.0);
        setCameraTargetOffset(target, offset);
    }
}, {
    text : 'Mount San Antonio',
    onselect : function() {
        target = Cesium.Cartesian3.fromDegrees(-117.6467, 34.2889, 0.0);
        offset = new Cesium.Cartesian3(5000, -5000.0, 5000.0);
        setCameraTargetOffset(target, offset);
    }
}, {
    text : 'Mount Williamson',
    onselect : function() {
        target = Cesium.Cartesian3.fromDegrees(-118.3112, 36.6560, 0.0);
        offset = new Cesium.Cartesian3(5000, -5000.0, 5000.0);
        setCameraTargetOffset(target, offset);
    }
}, {
    text : 'Mount Shasta',
    onselect : function() {
        target = Cesium.Cartesian3.fromDegrees(-122.1949, 41.4099, 0.0);
        offset = new Cesium.Cartesian3(10000, -5000.0, 5000.0);
        setCameraTargetOffset(target, offset);
    }
}];

Sandcastle.addToolbarMenu(cameraTargets);
////////////////////////////////////////////////

////////////////////////////////////////////////
// Split View
californiaLayers[1].splitDirection = Cesium.ImagerySplitDirection.LEFT; // Only show to the left of the slider.

// Sync the position of the slider with the split position
var slider = document.getElementById('slider');
viewer.scene.imagerySplitPosition = (slider.offsetLeft) / slider.parentElement.offsetWidth;

var dragStartX = 0;

document.getElementById('slider').addEventListener('mousedown', mouseDown, false);
window.addEventListener('mouseup', mouseUp, false);

function mouseUp() {
    window.removeEventListener('mousemove', sliderMove, true);
}

function mouseDown(e) {
    var slider = document.getElementById('slider');
    dragStartX = e.clientX - slider.offsetLeft;
    window.addEventListener('mousemove', sliderMove, true);
}

function sliderMove(e) {
    var slider = document.getElementById('slider');
    var splitPosition = (e.clientX - dragStartX) / slider.parentElement.offsetWidth;
    slider.style.left = 100.0 * splitPosition + "%";
    viewer.scene.imagerySplitPosition = splitPosition;
}
//Sandcastle_End
    Sandcastle.finishedLoading();
}
if (typeof Cesium !== "undefined") {
    startup(Cesium);
} else if (typeof require === "function") {
    require(["Cesium"], startup);
}
</script>
</body>
</html>
